# –µ—Å—Ç—å –≤–æ—Ç —Ç–∞–∫–æ–π —Å—Ç–µ–π—Ç –º–µ–Ω–µ–¥–∂–µ—Ä


```
export class Await {
	public readonly onReady: Promise<boolean>;
	private _readyResolve!: (value: boolean | PromiseLike<boolean>) => void;
	// private _readyReject!: (reason?: any) => void;
	constructor(){
		this.onReady = new Promise((resolve, reject)=>{
			this._readyResolve = resolve;
			// this._readyReject = reject;
		});
	}

	protected markAsReady(){
		this._readyResolve(true);
	}
}
```

```
import { PrimitiveRecord, Primitives, IUpdateStateEvent, IUpdateConditionEvent, CheckConditionHandler, PrimitiveSimple, checkValueAsPrimitiveSimple, checkValueAsStateNode } from "../common/commonTypes";
import { Await } from "../common/Await";

export class State extends Await {
	private data: PrimitiveRecord = {};
	private listeners: Map<string, Set<CheckConditionHandler>> = new Map();

	constructor() {
		super();
		// TODO –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ —Å—Ç–µ–π—Ç –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–æ–æ –∏ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–Ω–µ—Å—Ç–∏ setReady() –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–µ–π—Ç–∞
		this.markAsReady();
	}

	private cloneData(data: Primitives): Primitives {
		return Array.isArray(data) ? [...data] : data && typeof data === 'object' ? structuredClone(data) : data;
	}


	public set(path: string, value: PrimitiveSimple) {
		if (!checkValueAsPrimitiveSimple(value)) {
			throw new Error('Data is not of type PrimitiveSimple');
		}					
		// –≤–æ–∑–º–æ–∂–Ω–æ PrimitiveSimple –±—É–¥–µ—Ç —Ä–∞—Å—Å—à–∏—Ä–µ–Ω –¥–æ –ø–ª–æ—Å–∫–∏—Ö –º–∞—Å—Å–∏–≤–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤
		const newValue = this.cloneData(value); 
		let oldValue: PrimitiveSimple;

		const keys = path.split('.');
		let node = this.data;

		keys.forEach((key: string, index: number) => {
			let nextNode: Primitives = node[key] as Primitives;
			if (index === keys.length - 1) {
				if (!checkValueAsPrimitiveSimple(nextNode)) throw new Error('Data is not of type PrimitiveSimple');
				oldValue = nextNode as PrimitiveSimple;
				node[key] = newValue;
				return;
			}

			if (!checkValueAsStateNode(nextNode)){
				throw new Error('Data is not of type Object');
			}
			node = node[key] = (nextNode ?? {}) as PrimitiveRecord;
		});

		if (newValue === oldValue) return;

		this.notify(path, { path, newData: value, oldData: oldValue });
	}

	// public getKeys(path: string): Array<string> {
	// 	let node: Primitives = this.getOriginal(path);
	// 	if (!node || typeof node !== 'object') return [];
	// 	return Object.keys(node as PrimitiveRecord)
	// }

	public get(path: string): Primitives {
		const node = this.getOriginal(path);
		return this.cloneData(node);
	}

	private getOriginal(path: string): Primitives {
		let node: Primitives = this.data;
		if (path === '') return node;
		path
			.split('.')
			.every((key) => {
				if (!node) return false;
				if (typeof node !== 'object') return false;
				node = (node as PrimitiveRecord)[key];
				return true;
			});
		return node;
	}

	public on(path: string, callback: CheckConditionHandler) {
		if (!this.listeners.has(path)) {
			this.listeners.set(path, new Set());
		}
		this.listeners.get(path)!.add(callback);
	}

	public off(path: string, callback: CheckConditionHandler): void {
		const listeners = this.listeners.get(path);
		listeners?.delete(callback);
		if (listeners?.size === 0) {
			this.listeners.delete(path);
		}
	}

	private async notify(path: string, data: IUpdateStateEvent) {
		const keys = path.split('.');
		if (keys.length === 0) return;

		let list: string[] = [];
		for (const key of keys) {
			list.push(key)
			const curentPath = list.join('.');
			const listeners = this.listeners.get(curentPath) ?? new Set();

			if (listeners.size === 0) continue;
			const isSubPath = path !== curentPath;
			const conditionEvent: IUpdateConditionEvent = {
				update: data,
				path: curentPath,
				newData: isSubPath ? this.get(curentPath) : this.cloneData(data.newData)
			};
			for (const listener of listeners) {
				await listener(conditionEvent);
			}
		}
	}
}

```

```
import { Await } from '../common/Await';
import { ChangeActiveHandler, CheckConditionHandler, Primitives, IUpdateConditionEvent, checkValueAsPrimitiveSimple, PrimitiveSimple } from '../common/commonTypes';
import { StateManager } from '../StateManager';

export interface IStateWatcherData {
	amount: number,
	watcher: StateWatcher
}

export class StateWatcher extends Await {
	public readonly state: StateManager;
	public readonly name: string;
	public readonly path: string;
	private _checkConditionHandler: CheckConditionHandler;
	private _countOfUses: number = 0;
	

	_isActive: boolean = false;
	_data: Primitives = null;
	_listeners: Set<ChangeActiveHandler> = new Set();

	constructor(state: StateManager, name: string, path: string, checkConditionHandler?: CheckConditionHandler) {
		super();
		this.state = state;
		this.name = name;
		this.path = path;
		this._checkConditionHandler = checkConditionHandler ?? this.checkConditionHandler;
		this.init();
	}

	private async init() {
		await this.state.onReady;
		this._data = this.state.getValue(this.path); // TODO —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ stateAPI
		this._isActive = await this._checkConditionHandler({
			update: {
				path: this.path,
				newData: this._data as PrimitiveSimple,
				oldData: this._data as PrimitiveSimple
			},
			path: this.path,
			newData: this._data,
			oldData: this._data
		});
		this.state.onStateUpdate(this.path, this.onUpdate); // TODO —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ stateAPI
		console.log('>>>', 'init condition', this.name, this._isActive)
		this.markAsReady();
	}

	on(listener: ChangeActiveHandler) {
		this._listeners.add(listener);
		this._countOfUses ++;
	}

	off(listener: ChangeActiveHandler) {
		this._listeners.delete(listener);
		this._countOfUses --;
	}

	get data(): Primitives {
		return this._data;
	}

	get isActive(): boolean {
		return this._isActive;
	}

	private checkConditionHandler = async (event: IUpdateConditionEvent): Promise<boolean> => {
		// –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–ª–ª–±—ç–∫ 
		// –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
		return event.path === event.path && !!event.update.newData === true;
	};


	private onUpdate = async (event: IUpdateConditionEvent) => {
		const data: IUpdateConditionEvent = {
			...event,
			oldData: this._data,
			newData: event.newData
		}
		this._data = event.newData;
		const isActive = this._isActive;
		this._isActive = await this._checkConditionHandler(data);

		if (this._isActive !== isActive) await this.notify();

		return isActive;
	}

	private async notify() {
		for (const listener of this._listeners) {
			await listener(this._isActive);
		}
	}

	public destroy() {
		this._listeners.clear();
		this.state.offStateUpdate(this.path, this.onUpdate);
	}
}

```

```
import { Await } from "./common/Await";
import { CheckConditionHandler, PrimitiveSimple, Primitives } from "./common/commonTypes";
import { State } from './state/State';
import { IStateWatcherData, StateWatcher } from "./trigger/StateWatcher";

export class StateManager  extends Await{
	public readonly name:string;
	private readonly state: State = new State();
	private readonly watchers: Map<string, IStateWatcherData> = new Map(); // TODO –ø–æ–¥—É–º–∞—Ç—å –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

	constructor(name: string){
		super()
		this.name = name;
		this.init();
	}
	private async init() {
		await this.state.onReady;
		this.markAsReady();
	}

	public setValue(path: string, value: PrimitiveSimple): void {
		this.state.set(path, value);
	}

	public getValue(path: string): Primitives {
		return this.state.get(path);
	}

	public onStateUpdate(path: string, callback: CheckConditionHandler): void {
		this.state.on(path, callback)
	}

	public offStateUpdate(path: string, callback: CheckConditionHandler): void {
		this.state.off(path, callback)
	}
}
```
–≤–æ—Ç –ø—Ä–∏–º–µ—Ä –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```
import { ConditionFacade, IUpdateConditionEvent, StateManager, TriggerFacade } from "ohae_state";



(async function() {
	// —Ç–µ—Å—Ç–∏—Ä—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ StateManager


	const state = new StateManager('test');
	await state.onReady;
	const stateData = state.getValue('');
	console.log('!!!!!!!!!!!', stateData);
	
	
	state.setValue('novel.name', 'lower');
	state.setValue('novel.curentScene.name', '01_start');
	state.setValue('player.name', 'Alice');
	state.setValue('player.health', 100);
	state.setValue('player.isDeath', false);
	
	state.setValue('player.inventory.slot1', 'item1');
	state.setValue('player.inventory.slot2', null);
	
	
	// await StateFacade.addCondition('player', 'player', (event:UpdateConditionEvent)=>{
	// 	// console.log('>>>', 'update player condition', event);
	// 	return true;
	// });
	
	await ConditionFacade.add(state, 'slot1', 'player.inventory.slot1', (event:IUpdateConditionEvent)=>{
		console.log('>>>', 'update slot1 condition', event);
		return event.update.newData === 'item1';
	});
	
	await ConditionFacade.add(state, 'slot2', 'player.inventory.slot2', (event:IUpdateConditionEvent)=>{
		console.log('>>>', 'update slot2 condition', event);
		return event.update.newData === 'item2';
	});

	await ConditionFacade.add(state, 'inventory', 'player.inventory', (event:IUpdateConditionEvent)=>{
		console.log('>>>', 'update inventory condition', event);
		return true;
	});
	
	
	await ConditionFacade.add(state, 'isNotDeath', 'player.isDeath', (event:IUpdateConditionEvent)=>{
		console.log('>>>', 'update isNotDeath condition', event);
		return !event.update.newData;
	});
	
	await TriggerFacade.add('test', ['slot1', 'slot2', 'inventory', 'isNotDeath']);
	TriggerFacade.on('test', (isActive: boolean)=>{
		console.log('>>>', 'activate trigger', 'test', isActive)
	});
		
	setTimeout(()=>{
		state.setValue('player.inventory.slot2', 'item2');
	}, 5000);

	setTimeout(()=>{
		state.setValue('player.inventory.slot2', 'item3');
	}, 10000);
	
	
})()
```

–∏ –≤–æ—Ç —Ç–∞–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ UI
```
import { EventHandlers, IOhaeViewOptions, LayoutDirection } from "./OhaeViewOptions";
import { OhaeBaseView } from "./widgets/OhaeBaseView";

export class OhaeUI {
    private static PREFIX: string = 'ohae-';
    private static viewTypes: Record<string, CustomElementConstructor> = {};
    private static viewList: Record<string, HTMLElement> = {};

    private parent: HTMLElement;
    public readonly view: Promise<HTMLElement | Text | (HTMLElement | Text)[] | null>;

    constructor(data: IOhaeViewOptions | string | (IOhaeViewOptions | string)[], parent: HTMLElement | string | null = null) {
        if (typeof parent === 'string') {
            this.parent = document.getElementById(parent) || document.body;
        } else {
            this.parent = parent || document.body;
        }
        this.view = OhaeUI.createView(data, this.parent);
    }

    static registerViewType(typeName: string, typeClass: CustomElementConstructor, options?: ElementDefinitionOptions) {
        OhaeUI.viewTypes[typeName] = typeClass;
        customElements.define(OhaeUI.getName(typeName), typeClass, options);
    }

    static getViewClassByType(typeName: string = 'layout'): CustomElementConstructor | undefined {
        return OhaeUI.viewTypes[typeName];
    }

    static getViewById(viewId: string): HTMLElement | undefined {
        return OhaeUI.viewList[viewId];
    }

    static isRegistered(typeName: string): boolean {
        return !!OhaeUI.viewTypes[typeName];
    }

    static getName(typeName: string): string {
        const list = typeName.split(/:/);
        if (list.length === 1) {
            return OhaeUI.viewTypes[typeName] ? OhaeUI.PREFIX + typeName : typeName;
        } else {
            return list[1];
        }
    }

    static getPrefixedId(id: string | number): string {
        return OhaeUI.PREFIX + id.toString();
    }

    static storeView(viewId: string, viewInstance: HTMLElement) {
        if (!viewId) return;
        OhaeUI.viewList[viewId] = viewInstance;
    }

    static async createView(data: IOhaeViewOptions | string | (IOhaeViewOptions | string)[], parent: HTMLElement): Promise<HTMLElement | (HTMLElement | Text)[] | Text | null> {
        if (!data) return null;

        if (typeof data === 'string') {
            return this.createHtmlBlock(data, parent);
        }

        if (Array.isArray(data)) {
            const fragments: (HTMLElement | Text)[] = [];
            for (const item of data) {
                const fragment = await OhaeUI.createView(item, parent);
                if (fragment) {
                    if (Array.isArray(fragment)) {
                        fragments.push(...fragment);
                    } else {
                        fragments.push(fragment);
                    }
                }

            }
            return fragments;
        }

        if (typeof data === 'object') {
            return await OhaeUI.createElement(data, parent);
        }
        return null;
    }

    private static createHtmlBlock(text: string, parent: HTMLElement): HTMLElement | Text | null {
        // const fragment = document.createTextNode(text);
        const fragment = document.createElement('span');
        parent.appendChild(fragment);
        fragment.innerHTML = text;
        return fragment;
        // parent.innerHTML += text;
        // return null;
    }

    public static async createElement(options: IOhaeViewOptions, parent?: HTMLElement): Promise<HTMLElement> {

        const viewType = options.view ?? 'layout';
        const viewName = OhaeUI.getName(viewType);
        const viewItem = document.createElement(viewName);
        OhaeUI.storeView(options.id, viewItem);

        if (viewItem instanceof OhaeBaseView) {
            viewItem.setAttribute('parentdirection', parent?.getAttribute('direction') ?? 'rows');
            await this.initOhaeHtmlElement(viewItem, options);
        } else {
            this.initStandartHtmlElement(viewItem, options);
        }
        parent?.appendChild(viewItem);

        this.applyListeners(viewItem, options.on);
        return viewItem;
    }

    private static async initOhaeHtmlElement(viewItem: OhaeBaseView, options: IOhaeViewOptions): Promise<void> {
        viewItem.setAttribute('direction', options.rows ? 'rows' : 'cols');
        const body = options.rows ?? options.cols ?? options.body;
        if (body) {
            await OhaeUI.createView(body, viewItem);
        }
        viewItem.init(options);
    }

    private static initStandartHtmlElement(viewItem: HTMLElement, options: IOhaeViewOptions) {
        Object.entries(options).forEach(([key, value]) => {
            if (key === 'id') {
                viewItem.setAttribute(key, this.getPrefixedId(value));
            } else if (typeof value != 'object' && value !== undefined) {
                (viewItem as OhaeBaseView).setAttribute(key, value.toString());
            }
        });
    }

    private static async applyListeners(element: HTMLElement, listeners?: EventHandlers): Promise<void> {
        if (!listeners) return;
        if (element instanceof OhaeBaseView) await element.onReady;
        Object.entries(listeners).forEach(([key, callback]) => {
            element.addEventListener(key, (event: Event) => {
                callback.call(element, event);
            });
        });
    }

}
```

```
export type AlignValues = 'flex-start' | 'flex-end' | 'center' | 'space-between' | 'space-around' | 'space-evenly' | 'start' | 'end' | 'none' ;
export type FlexAlignValues = 'stretch' | 'flex-start' | 'center' | 'flex-end' | 'baseline' | 'none';

type OhaeEventHandler = (this: HTMLElement, ev: Event) => void;

export interface  OhaeEvents {
    click?: OhaeEventHandler;
    change?: (this: HTMLElement, ev: Event) => void;
}

export type LayoutDirection = 'rows' | 'cols';

export interface IOhaeViewOptions {
    view?: string;
    backgroundColor?: string;
    block?: boolean | string;
    width?: string | number;
    minWidth?: string | number;
    maxWidth?: string | number;
    height?: string | number;
    minHeight?: string | number;
    maxHeight?: string | number;
    padding?: string | number;
    margin?: string | number;
    flex?: string | number;
    align?: AlignValues;
    valign?: FlexAlignValues;
    body?: (IOhaeViewOptions | string)[] | IOhaeViewOptions | string;
    rows?: (IOhaeViewOptions | string)[];
    cols?: (IOhaeViewOptions | string)[];
    on?: Record<string, (this: HTMLElement, ev: Event) => void>;

    [key: string]: any; // –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤
}

export type EventHandlers = Record<string, EventHandler>;
export type EventHandler = (this: HTMLElement, ev: Event) => void;

```

—Å —Ç–∞–∫–∏–º, –±–∞–∑–æ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º (–æ—Ç –Ω–µ–≥–æ –∏–ª–∏ –µ–≥–æ –ø–æ—Ç–æ–º–∫–æ–≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
```
import { OhaeUI } from '../OhaeUI.ts';
import { AlignValues, EventHandler, EventHandlers, IOhaeViewOptions, LayoutDirection } from '../OhaeViewOptions.ts';
import { Color } from '../utils/Color.ts';

import { SizeNumber } from '../utils/SizeNumber.ts';

export class OhaeBaseView extends HTMLElement {
	public static readonly ATTRIBUTES: string[] = [
		'id',
		'align',
		'valign',
		'flex',
		'width',
		'height',
		'maxWidth',
		'maxHeight',
		'minWidth',
		'minHeight',
		'padding',
		'margin',
		'backgroundColor',
		'parentdirection',
	];
	protected static readonly STYLES: string = `
		<style>
			/* —Ç—É—Ç —Å—Ç–∏–ª–∏, —è –∏—Ö –ø–æ–∫–∞ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ —É—Ä–∞–ª, —á—Ç–æ–±—ã —Ç—ã –Ω–∞ –Ω–∏—Ö –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–¥—Å—è*/
		</style>
	`;
	protected static readonly FONT_AVESOME: string = `
		<style>
			/* —Ç—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ font awesome, —Ç–æ–∂–µ –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–π—Å—è –Ω–∞ —ç—Ç–æ*/			
		</style>	
	`;

	protected static readonly HTML: string = `
		<slot></slot>
	`;


	protected static readonly JUSTIFY_VALUES_MAP: Record<AlignValues, string> = {
			/* —Ç—É—Ç —Ç–æ–∂–µ —É–±—Ä–∞–ª, –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–π—Å—è –Ω–∞ —ç—Ç–æ*/			
	}
	public readonly onReady: Promise<boolean>;
	private _readyResolve!: (value: boolean | PromiseLike<boolean>) => void;
	protected onInitDataReady!: Promise<boolean>;
	protected initData!: IOhaeViewOptions;
	private _initDataReadyResolve!: (value: boolean | PromiseLike<boolean>) => void;
	protected shadow!: ShadowRoot;


	constructor() {
		super();
		this.onReady = new Promise((resolve) => this._readyResolve = resolve);
		this.onInitDataReady = new Promise((resolve) => this._initDataReadyResolve = resolve);
		this.shadow = this.attachShadow({ mode: 'open' });
		this.createCallback();
	}

	static get observedAttributes(): string[] {
		return [...OhaeBaseView.ATTRIBUTES];
	}

	protected async connectedCallback() {
		// await this.createCallback();
		this.markAsReady();
	}

	protected async createCallback() {
		await this.onInitDataReady;
		await this.render();
		this.applyAttributes(OhaeBaseView.observedAttributes);
	}

	protected markAsReady() {
		this._readyResolve(true);
	}

	protected markAsInitDataReady() {
		this._initDataReadyResolve(true);
	}

	public init(options: IOhaeViewOptions) {
		Object.entries(options ?? {}).forEach(([key, value]) => {
			if (key === 'id') {
				this.setAttribute(key, OhaeUI.getPrefixedId(value));
			} else if (typeof value != 'object' && value !== undefined) {
				if (value !== null) this.setAttribute(key, value.toString());
			}
		});
		this.initData = options;
		this._initDataReadyResolve(true);
	}

	protected disconnectedCallback() {
	}

	protected attributeChangedCallback(name: string, oldValue: string, newValue: string) {
		if (oldValue !== newValue) {
			this.applyAttribute(name, newValue);
		}
	}

	protected async render() {
		const staticThis = (this.constructor as typeof OhaeBaseView);
		this.shadowRoot!.innerHTML = staticThis.STYLES + staticThis.HTML;
	}

	public override addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {
		super.addEventListener(type, listener, options);
	}

	protected applyAttributes(attributes: string[]): void {
		attributes.forEach(name => {
			const value = this.getAttribute(name);
			if (value !== null) this.applyAttribute(name, value);
		});
	}

	protected applyAttribute(name: string, value: string): void {
		if (name in this) {
			(this as any)[name] = value;
		}
	}

	protected waitForShadowRoot(hostElement: HTMLElement = this): Promise<ShadowRoot> {
		return new Promise((resolve) => {
			if (hostElement.shadowRoot) {
				return resolve(hostElement.shadowRoot);
			}

			const observer = new MutationObserver((_, obs) => {
				if (hostElement.shadowRoot) {
					obs.disconnect();
					resolve(hostElement.shadowRoot);
				}
			});

			observer.observe(hostElement, {
				childList: false,
				subtree: false,
				attributes: false,
				// –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å ShadowRoot
				characterData: false,
			});
		});
	};

	get flex(): number | null {
		const value = this.getAttribute('flex');
		if (!value) return null
		return parseFloat(value);
	}
	set flex(value: string | number | null) {
		if (value === null) return;

		if (value === 'none') {
			this.style.flexGrow = 'none';
			this.setAttribute('flex', 'none');
		} else if (typeof value === 'number') {
			this.style.flexGrow = value.toString();
			this.setAttribute('flex', value.toString());
		} else {
			this.style.flexGrow = value;
		}
	}

	get backgroundColor(): Color | null {
		const backgroundColor = this.getAttribute('backgroundColor');
		if (!backgroundColor) return null;
		return new Color(backgroundColor);
	}
	set backgroundColor(value: string | Color | null) {
		if (!value) return;

		const color = typeof value === 'string' ? new Color(value) : value;
		this.setAttribute('backgroundColor', color.hex);

		this.style.setProperty("--host-bg", color.hex);
		this.style.setProperty("--host-color", color.contrast(0.5).mono().hex);
		this.style.setProperty("--host-hr-color", color.contrast(0.2).mono().hex);

		this.style.setProperty("--host-hover-bg", color.brightness(1.1).hex);
		this.style.setProperty("--host-active-bg", color.brightness(1.2).hex);
		this.style.setProperty("--host-border", color.brightness(0.8).hex);
		this.style.setProperty("--host-head-bg", color.brightness(0.5).mono().hex);
		this.style.setProperty("--host-head-color", color.contrast(0.5).mono().hex);
	}

	get align(): string | null {
		return this.getAttribute('valign');
	}
	set align(value: string | null) {
		if (value === null) return;
		this.setAttribute('align', value);
		this.style.textAlign = OhaeBaseView.JUSTIFY_VALUES_MAP[value as AlignValues];
		this.style.justifyContent = value;
	}

	get valign(): string | null {
		return this.getAttribute('align');
	}
	set valign(value: string | null) {
		if (value === null) return;
		this.style.alignItems = value;
	}

	get margin(): string | null {
		return this.getAttribute('margin');
	}
	set margin(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('margin', parsedValue);
		this.style.margin = parsedValue;
	}

	get padding(): string | null {
		return this.getAttribute('padding');
	}
	set padding(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('padding', parsedValue);
		this.style.padding = parsedValue;
	}

	get height(): string | null {
		return this.getAttribute('height');
	}
	set height(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('height', parsedValue);
		this.style.height = parsedValue;
	}

	get minHeight(): string | null {
		return this.getAttribute('minHeight');
	}

	set minHeight(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('minHeight', parsedValue);
		this.style.minHeight = parsedValue;
	}

	get maxHeight(): string | null {
		return this.getAttribute('maxHeight');
	}
	set maxHeight(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('maxHeight', parsedValue);
		this.style.maxHeight = parsedValue;
	}

	get width(): string | null {
		return this.getAttribute('width');
	}
	set width(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('width', parsedValue);
		this.style.width = parsedValue;
	}

	get minWidth(): string | null {
		return this.getAttribute('minWidth');
	}
	set minWidth(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('minWidth', parsedValue);
		this.style.minWidth = parsedValue;
	}

	get maxWidth(): string | null {
		return this.getAttribute('maxWidth');
	}

	set maxWidth(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('maxWidth', parsedValue);
		this.style.maxWidth = parsedValue;
	}

	protected parseSizeValue(value: string | number): string {
		value = value.toString()
		const parsedNumber = parseFloat(value);
		if (typeof parsedNumber === 'number') {
			const number = new SizeNumber(value);
			return number.toString();
		} else {
			return value;
		}
	}

	protected parseNumberValue(value: string | number): string {
		const number = new SizeNumber(value);
		return number.toNumber().toString();
	}

	protected setBooleanAttribute(attributeName: string, value: boolean | string | null, target?: HTMLElement): boolean {
		value = value === true || value === 'true';
		target = target ?? this;
		if (value) {
			target.setAttribute(attributeName, value.toString());
		} else {
			target.removeAttribute(attributeName);
		}
		return value;
	}
}

OhaeUI.registerViewType('base', OhaeBaseView);
```

–¥–∞–ª–µ–µ –ø—Ä–∏–º–µ—Ä –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```
import { OhaeUI } from '../../OhaeUI';
import { OhaeBaseView } from '../OhaeBaseView';

export class OhaeLayoutView extends OhaeBaseView {
    public static readonly ATTRIBUTES: string[] = [
        'collapsed',
        'direction',
        'overflow',
        'overflowX',
        'overflowY',
    ];
	protected static readonly STYLES: string = `
        <style>
            :host {
                border-radius: 3px;
                display: flex;
                overflow: auto;
                box-sizing: border-box;
                padding: 0px;
                margin: 0px;
                flex-grow: 1;
            }
            /* :host(:not([backgroundColor])) { */
            :host([backgroundColor]) {
                background-color:  var(--host-bg, #333);
                box-shadow: 2px 2px 2px rgba(0, 0, 0, .1);
                color: var(--host-color, #ddd);
            }
            :host([direction="rows"]) {
                flex-direction: column;
            }
            :host([direction="cols"]) {
                flex-direction: row;
            }
            :host([collapsed]) {
                display: none;
            }
            ::slotted(*) {
                flex: 1;  /* –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ª–æ—Ç–∞ –±—É–¥—É—Ç —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å—Ç—è–Ω—É—Ç—ã */
                min-width: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å—É–∂–∞—Ç—å—Å—è */
            }
        </style>
	`;

    private resizeObserver: ResizeObserver;

    constructor() {
        super();
        this.resizeObserver = new ResizeObserver(() => this.handleResize());
    }

    static get observedAttributes() {
        return [...super.observedAttributes, ...this.ATTRIBUTES];
    }

    protected override async createCallback() {
        await super.createCallback();
        this.applyAttributes(OhaeLayoutView.ATTRIBUTES);
        this.resizeObserver.observe(this);
    }

    protected override disconnectedCallback() {
        super.disconnectedCallback();
        this.resizeObserver.disconnect();
    }

    private handleResize() {
        // –õ–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤
    }

    public show() {
        this.collapsed = false;
    }

    public hide() {
        this.collapsed = true;
    }

    get overflow(): string | null {
        return this.getAttribute('overflow');
    }
    set overflow(value: string | null) {
        if (value === null) return;
        this.setAttribute('overflow', value);
        this.style.overflow = value;
    }

    get overflowX(): string | null {
        return this.getAttribute('overflowX');
    }
    set overflowX(value: string | null) {
        if (value === null) return;
        this.setAttribute('overflowX', value);
        this.style.overflowX = value;
    }

    get overflowY(): string | null {
        return this.getAttribute('overflowY');
    }
    set overflowY(value: string | null) {
        if (value === null) return;
        this.setAttribute('overflowY', value);
        this.style.overflowY = value;
    }

    get collapsed(): boolean {
		return this.getAttribute('collapsed') === 'true';
	};
	set collapsed(value: boolean | string | null) {
        this.setBooleanAttribute('collapsed', value);
    }
}

OhaeUI.registerViewType('layout', OhaeLayoutView);


declare module "../../OhaeViewOptions" {
    interface IOhaeViewOptions {
        collapsed?: boolean | string;
        direction?: LayoutDirection;
        overflow?: string;
        overflowX?: string;
        overflowY?: string;
    }
}
```

```
import { OhaeUI } from "../../OhaeUI";
import { OhaeLayoutView } from "../layout-view/OhaeLayoutView";
import { OhaeAccordionItemView } from "./OhaeAccordionItemView";

export class OhaeAccordionView extends OhaeLayoutView {
    public static readonly ATTRIBUTES: string[] = [
        'multiple',
        'enableShift',
        'enableDrag',
    ];

    protected static readonly STYLES: string = `
    <style>
	/* —Ç—É—Ç —Å—Ç–∏–ª–∏, —è –∏—Ö –ø–æ–∫–∞ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ —É—Ä–∞–ª, —á—Ç–æ–±—ã —Ç—ã –Ω–∞ –Ω–∏—Ö –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–¥—Å—è*/
    </style>
    `;
    public draggedSection: OhaeAccordionItemView | null = null;

    protected override async createCallback() {
        await super.createCallback();
        this.applyAttributes(OhaeAccordionView.ATTRIBUTES);
        this.addEventListener('section-toggle', this.handleSectionToggle as EventListener);
        this.addEventListener('dragover', this.handleDragOver as EventListener);
        this.addEventListener('drop', this.handleDrop as EventListener);
    }

    static get observedAttributes() {
        return [...super.observedAttributes, ...this.ATTRIBUTES];
    }

    private handleDragOver(event: DragEvent) {
        event.preventDefault();
        const target = event.target as HTMLElement;
        const section = target.closest('ohae-accordion-item') as OhaeAccordionItemView | null;
        if (section && this.draggedSection && section !== this.draggedSection) {
            const rect = section.getBoundingClientRect();
            const isAfter = event.clientY > rect.top + rect.height / 2;
            console.log(1);
            if (isAfter) {
                if(section.nextElementSibling === this.draggedSection) return
                section.after(this.draggedSection);
            } else {
                if(section.previousElementSibling === this.draggedSection) return
                section.before(this.draggedSection);
            }
        }
    }
    
    private handleDrop(event: DragEvent) {
        event.preventDefault();
        this.draggedSection = null;
    }

    private handleSectionToggle(event: Event) {
        const customEvent = event as CustomEvent;
        const targetSection = customEvent.detail.section as OhaeAccordionItemView;
        this.tryToggledSections(targetSection);
        this.tryShiftToggledSection(targetSection);
    }

    private tryToggledSections(ignoreSection: OhaeAccordionItemView) {
        const sections = this.querySelectorAll('ohae-accordion-item') as NodeListOf<OhaeAccordionItemView>;
        if (!this.multiple) {
            sections.forEach(section => {
                if (section !== ignoreSection) {
                    section.collapsed = true; // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π
                }
            });
        }
    }

    private tryShiftToggledSection(targetSection: OhaeAccordionItemView) {
        if (this.enableShift) {
            const sections = this.querySelectorAll('ohae-accordion-item') as NodeListOf<OhaeAccordionItemView>;
            // const isColapsed = targetSection.collapsed;
            Array.from(sections).some(section => {
                if (section !== targetSection && section.collapsed) {
                    // if (isColapsed) {
                    //     this.insertBefore(targetSection, section);
                    // } else {
                        this.insertBefore(targetSection, section);
                    // }
                    return true;
                }
            });
            this.scrollTop = 0;
        }
    }


    get multiple(): boolean {
        return this.getAttribute('multiple') === 'true';
    };
    set multiple(value: boolean | string | null) {
        this.setBooleanAttribute('multiple', value);
    }

    get enableShift(): boolean {
        return this.getAttribute('enableShift') === 'true';
    };
    set enableShift(value: boolean | string | null) {
        this.setBooleanAttribute('enableShift', value);
    }
    
    get enableDrag(): boolean {
        return this.getAttribute('enableDrag') === 'true';
    };
    set enableDrag(value: boolean | string | null) {
        this.setBooleanAttribute('enableDrag', value);
    }
}

OhaeUI.registerViewType('accordion', OhaeAccordionView);

declare module "../../OhaeViewOptions" {
    interface IOhaeViewOptions {
        enableShift?: string | boolean;
        multiple?: string | boolean | number;
    }
}
```

```
import { OhaeUI } from "../../OhaeUI";
import { OhaeLayoutView } from "../layout-view/OhaeLayoutView";
import { OhaeAccordionView } from "./OhaeAccordionView";

export class OhaeAccordionItemView extends OhaeLayoutView {
    public static readonly ATTRIBUTES: string[] = [
        'collapsed',
        'header',
        'openIcon',
        'closeIcon',
    ];

    protected static readonly STYLES: string = `
    <style>
	/* —Ç—É—Ç —Å—Ç–∏–ª–∏, —è –∏—Ö –ø–æ–∫–∞ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ —É—Ä–∞–ª, —á—Ç–æ–±—ã —Ç—ã –Ω–∞ –Ω–∏—Ö –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–¥—Å—è*/
    </style>
    ` + this.FONT_AVESOME;
    protected static readonly ICON_OPEN: string = 'fa-angle-right'; // fa-chevron-right
    protected static readonly ICON_CLOSE: string = 'fa-angle-down'; // fa-chevron-down
    protected static readonly ICON_MOVE: string = 'fa-ellipsis-h'; // fa-ellipsis-h

    protected static readonly HTML: string = `
        <div class="header">
            <span id='icon-wrapper'><span id='icon' class='icon fa ${this.ICON_CLOSE}'></span></span>
            <div class="header-body"></div>
            <span id='icon-wrapper'><span id='icon-move' class='icon-move fa ${this.ICON_MOVE}'></span></span>
        </div>
        <div class="body">
            <slot></slot>
        </div>
    `;
    private iconElement?: HTMLElement;
    private moveIconElement?: HTMLElement;

    protected override async createCallback() {
        await super.createCallback();
        this.iconElement = this.shadowRoot?.querySelector('.icon') as HTMLElement;
        this.applyAttributes(OhaeAccordionItemView.ATTRIBUTES);
        this.backgroundColor = this.backgroundColor ?? "#444";

        const header = this.shadowRoot?.querySelector('.header') as HTMLElement;
        if (header) {
            header.addEventListener('click', this.toggleCollapse.bind(this) as EventListener);
        }

        this.moveIconElement = this.shadowRoot?.querySelector('#icon-move') as HTMLElement;
        
        this.updateIcon();
        this.updateEnableDragging();
    }

    static get observedAttributes() {
        return [...super.observedAttributes, ...this.ATTRIBUTES];
    }

    private updateEnableDragging(): void {
        this.moveIconElement?.removeEventListener('mousedown', this.handleDragIconStart as EventListener);
        this.moveIconElement?.removeEventListener('mouseup', this.handleDragIconEnd as EventListener);
        const enableDragging = true; //this.enableDragging;
        if(enableDragging){
            this.moveIconElement?.addEventListener('mousedown', this.handleDragIconStart as EventListener);
            this.moveIconElement?.addEventListener('mouseup', this.handleDragIconEnd as EventListener);
        }
    }

    private handleDragIconStart = (event: Event)=>{
        this.draggable = true;
        this.addEventListener('dragstart', this.handleDragStart as EventListener);
        this.addEventListener('dragend', this.handleDragEnd as EventListener);
    }

    private handleDragIconEnd = (event: Event)=>{
        this.draggable = false;
        this.removeEventListener('dragstart', this.handleDragStart as EventListener);
        this.removeEventListener('dragend', this.handleDragEnd as EventListener);
    }

    private handleDragStart(event: DragEvent) {
        event.stopPropagation();
        
        this.style.opacity = '0.4';

        // const accordion = this.closest('ohae-accordion-view') as OhaeAccordionView | null;
        const accordion = this.parentElement as OhaeAccordionView;
        if (accordion) {
            accordion.draggedSection = this;
        }

        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É 1x1
        const emptyImage = new Image();
        emptyImage.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxIiBoZWlnaHQ9IjEiPjwvc3ZnPg==';
        event.dataTransfer?.setDragImage(emptyImage, 0, 0);
    }
    
    private handleDragEnd() {
        this.draggable = false;
        this.style.opacity = '';
    }

    private toggleCollapse() {
        this.collapsed = !this.collapsed;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è section-toggle
        const event = new CustomEvent('section-toggle', {
            bubbles: true, // –°–æ–±—ã—Ç–∏–µ –≤—Å–ø–ª—ã–≤–∞–µ—Ç –¥–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            composed: true, // –°–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã Shadow DOM
            detail: { section: this, collapsed: this.collapsed },
        });
        this.dispatchEvent(event);
    }

    private updateIcon() {
        if (!this.iconElement) return;
        this.iconElement.className = `icon fa ${this.collapsed ? this.openIcon : this.closeIcon}`;
        //this.iconElement.style.color = (this.collapsed ? this.color?.rgba : this.color?.brightness(0.7).rgba) ?? "#fff";
    }

    get collapsed(): boolean {
        return this.getAttribute('collapsed') === 'true';
    };
    set collapsed(value: boolean | string | null) {
        value = this.setBooleanAttribute('collapsed', value);
        const body = this.shadowRoot?.querySelector('.body') as HTMLElement;
        if (value) {
            body?.classList.add('collapse');
        } else {
            body?.classList.remove('collapse');
        }
        this.updateIcon();
    }

    get header(): string {
        const headerBody = this.shadowRoot?.querySelector('.header-body') as HTMLElement;
        return headerBody?.innerText ?? '';
    }
    set header(value: string) {
        const headerBody = this.shadowRoot?.querySelector('.header-body') as HTMLElement;
        if (headerBody) {
            headerBody.innerText = value ?? '';
        }
    }

    get openIcon(): string {
        return this.getAttribute('openIcon') || OhaeAccordionItemView.ICON_OPEN;
    }
    set openIcon(value: string) {
        this.setAttribute('openIcon', value);
        this.updateIcon();
    }

    get closeIcon(): string {
        return this.getAttribute('closeIcon') || OhaeAccordionItemView.ICON_CLOSE;
    }
    set closeIcon(value: string) {
        this.setAttribute('closeIcon', value);
        this.updateIcon();
    }

}

OhaeUI.registerViewType('accordion-item', OhaeAccordionItemView);

declare module "../../OhaeViewOptions" {
    interface IOhaeViewOptions {
        collapsed?: string | boolean;
        header?: string;
        openIcon?: string;
        closeIcon?: string;
    }
}

```

```
import { OhaeUI } from "../../OhaeUI";
import { OhaeBaseView } from "../OhaeBaseView";

export class OhaeBaseInputView extends OhaeBaseView {
	public static readonly ATTRIBUTES: string[] = [
		'value',		
		'name',
		'separator',
		'label',
		'inputWidth',
		'disabled',
		'readonly',
		'required',
		'reverse',
	];

	protected static readonly STYLES: string = `
	<style>
		/* —Ç—É—Ç —Å—Ç–∏–ª–∏, —è –∏—Ö –ø–æ–∫–∞ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ —É—Ä–∞–ª, —á—Ç–æ–±—ã —Ç—ã –Ω–∞ –Ω–∏—Ö –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–¥—Å—è*/
	</style>
	`;

	protected static readonly HTML: string = `
		<div class="input-wrapper">
			<div class="input-box">
				<label class="input-container">
					<input class="input" />
					<span class="switch"></span>
				</label>				
			</div>
			<div class="input-separator"></div>
			<label class="input-label"></label>
		</div>
	`;
	protected oldValue: any;


	protected override async createCallback() {
		await super.createCallback();
		this.applyAttributes(OhaeBaseInputView.ATTRIBUTES);
		this.oldValue = this.value;
	}

	static get observedAttributes() {
		return [...super.observedAttributes, ...this.ATTRIBUTES];
	}

	protected get inputWrapperView(): HTMLDivElement {
		return this.shadowRoot?.querySelector('.input-wrapper') as HTMLDivElement;
	}

	protected get inputBoxView(): HTMLDivElement {
		return this.shadowRoot?.querySelector('.input-box') as HTMLDivElement;
	}

	protected get inputView(): HTMLInputElement {
		return this.shadowRoot?.querySelector('input') as HTMLInputElement;
	}

	protected get separatorView(): HTMLDivElement {
		return this.shadowRoot?.querySelector('.input-separator') as HTMLDivElement;
	}

	protected get labelView(): HTMLLabelElement {
		return this.shadowRoot?.querySelector('.input-label') as HTMLLabelElement;
	}


	private static readonly inputListeners: string[] = ['change'];
	public override addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void{
		if(OhaeBaseInputView.inputListeners.includes(type)){
			this.inputView.addEventListener(type, (e)=>{
				e.stopPropagation();
				this.modifyInputEvent(e as InputEvent);
			});
		}
		super.addEventListener(type, listener, options);
	}
	
	private modifyInputEvent(originalEvent: InputEvent): void {
		if(this.oldValue === this.value) return;
		const detail = {
			originalEvent,
			newValue: this.value,
			oldValue: this.oldValue,
		};
		const event = new CustomEvent(originalEvent.type, {
			bubbles: true, // –°–æ–±—ã—Ç–∏–µ –≤—Å–ø–ª—ã–≤–∞–µ—Ç –¥–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
			composed: true, // –°–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã Shadow DOM
			detail,
		});

		this.dispatchEvent(event);
		if(originalEvent.type === 'change')	this.oldValue = this.value;
	}


	get value(): string | number | boolean {
		return this.inputView?.value;
	}
	set value(value: string | number | boolean | null) {
		if (value === null) return;
		this.setAttribute('value', value.toString());
		const view = this.inputView;
		if (view) view.value = value.toString();
	}

	get name(): string | null {
		return this.getAttribute('name');
	}
	set name(value: string | null) {
		if (value === null) {
			this.removeAttribute('name');
			this.inputView?.removeAttribute('name');
		} else {
			this.setAttribute('name', value);
			this.inputView?.setAttribute('name', value);
		}
	}

	get separator(): string {
		return this.separatorView?.innerText || 'üí•'; //'‚óè';
	}
	set separator(value: string | null) {
		if (value === null) return;
		this.setAttribute('separator', value);

		const view = this.separatorView;
		if (view) view.innerText = value;
	}

	get label(): string | null {
		return this.getAttribute('label');
	}
	set label(value: string | null) {
		if (value === null) return;
		this.setAttribute('label', value);

		const view = this.labelView;
		if (view) view.innerText = value;
	}

	get inputWidth(): string | null {
		return this.getAttribute('inputWidth');
	}
	set inputWidth(value: string | number | null) {
		if (value === null) return;
		const parsedValue = this.parseSizeValue(value);
		this.setAttribute('inputWidth', parsedValue);
		this.inputBoxView?.style.setProperty('--input-width', parsedValue);
	}

	get disabled(): boolean {
		return this.getAttribute('disabled') === 'true';
	};
	set disabled(value: boolean | string | null) {
		this.setBooleanAttribute('disabled', value);
		this.setBooleanAttribute('disabled', value, this.inputView);
	}

	get readonly(): boolean {
		return this.getAttribute('readonly') === 'true';
	};
	set readonly(value: boolean | string | null) {
		value = this.setBooleanAttribute('readonly', value);
		const view = this.inputView;
		if ((view as any)?.readOnly) (view as any).readOnly = value;
	}

	get required(): boolean {
		return this.getAttribute('required') === 'true';
	};
	set required(value: boolean | string | null) {
		value = this.setBooleanAttribute('required', value);
		const view = this.separatorView;
		if (!view) return;
		view.innerText = value ? this.separator : '';
	}

	get reverse(): boolean {
		return this.getAttribute('reverse') === 'true';
	};
	set reverse(value: boolean | string | null) {
		value = this.setBooleanAttribute('reverse', value);
		if (!this.inputBoxView || !this.labelView || !this.inputWrapperView) return;
	}
}

OhaeUI.registerViewType('base-input', OhaeBaseInputView);


declare module "../../OhaeViewOptions" {
    interface IOhaeViewOptions {
		name?: string;
		separator?: string;
		label?: string;
		inputWidth?: string | number;
		disabled?: string | boolean;
		readonly?: string | boolean;
		required?: string | boolean;
		reverse?: string | boolean;
    }
}
```

–≤–æ—Ç –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```
import "./core/widgets/OhaeBaseView";
import "./core/widgets/OhaeFieldsetView";
import "./core/widgets/layout-view/OhaeLayoutView";
import "./core/widgets/layout-view/OhaeResizerView";
import "./core/widgets/layout-view/OhaeSeparatorView";
import "./core/widgets/input_view/OhaeButtonView";
import "./core/widgets/input_view/OhaeFormView";
import "./core/widgets/input_view/OhaeInputView";
import "./core/widgets/input_view/OhaeSelectView";
import "./core/widgets/input_view/OhaeTextareaView";
import "./core/widgets/input_view/OhaeIconCheckboxView";
import "./core/widgets/input_view/OhaeIconSelectView";
import "./core/widgets/accordion_view/OhaeAccordionView";
import "./core/widgets/accordion_view/OhaeAccordionItemView";
import "./core/widgets/icons_view/OhaeIconOfTypeView";
import "./core/widgets/tabs_view/OhaeTabsView";
import "./core/widgets/tabs_view/OhaeTabItemButton";
import "./core/widgets/tabs_view/OhaeTabItemView";
import "./core/widgets/data_table_view/OhaeDataTableView";
import "./external_widgets/OhaeAceEditor";
import "./external_widgets/BlenderNumberInput";

import { IOhaeViewOptions } from "./core/OhaeViewOptions";
import { OhaeUI } from './core/OhaeUI';
import { OhaeLayoutView } from "./core/widgets/layout-view/OhaeLayoutView";
import { workSpaceViewData } from "./custom_views_data/workspace_view/workSpaceViewData";
import { ConditionFacade, IUpdateConditionEvent, StateManager, TriggerFacade } from "ohae_state";

// –ü—Ä–∏–º–µ—Ä JSON-–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
const dataInputView: IOhaeViewOptions = {
	view: 'layout',
	minWidth: '100%',
	overflow: 'hidden',
	// overflowX: 'scroll',
	// overflowY: 'scroll',
	rows: [
		{ view: 'layout', backgroundColor: '#111', minHeight: 26, maxHeight: 26, 
			body: {
				view: 'layout',
				padding: 0,
				// backgroundColor: '#411',
				cols: [
					{
						view: 'layout',
						maxHeight: 24,
						maxWidth: 48,
						minWidth: 48,
						overflow: 'hidden',
						margin: 6,
						flex: 0,
						valign: 'center',
						body: {
							view: 'img',
							height: '16px',
							src: './assets/logo_64.png',
							on: {
								click: function (){
									console.log('logo')
								}
							}
						},
				
					},
					{
						flex: 1
					},
				],
			}
		},
		{ view: 'layout', minHeight: 1, maxHeight: 1 },
		workSpaceViewData, 
		{ view: 'layout', minHeight: 1, maxHeight: 1 },
		{ view: 'layout', backgroundColor: '#111', minHeight: 22, maxHeight: 22 },
	],
};


const ui = new OhaeUI(dataInputView, document.body);

const element = OhaeUI.getViewById('main') as OhaeLayoutView;

// –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π workSpaceViewData –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, (–Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ç–∞–º —Ç–∞–∫–¥–µ –∏–¥—É—Ç –æ—Ç—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)


```


–¥–∞–≤–∞–π –ø–æ–¥—É–º–∞–µ–º –∫–∞–∫ –±—É–¥–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ –≤—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç–µ–π—Ç –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É UI.
–û—Ü–µ–Ω–∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ø—Ä–µ–¥–ª–æ–∂–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –æ–ø–∏—à–∏ –∏—Ö, —É–∫–∞–∂–∏ –¥–ª—è –Ω–∏—Ö –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã, –æ—Ü–µ–Ω–∏ –∫–∞–∫–æ–π –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–æ–±–æ–π –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ª—É—á—à–µ –ø–æ–¥–æ–π–¥–µ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–∞–∫–æ—Ç–æ—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä–æ–≤—ã—Ö –∞—Å—Å–µ—Ç–æ–≤ (–ø–æ —Ç–∏–ø—É adobe animate)

<hr>

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å—Ç–µ–π—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ UI-–±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:

### 1. –ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π `StateAwareComponent`, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –≤—Å–µ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
**–ü–ª—é—Å—ã**:
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø–∏—Å–∫–∞ –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

**–ú–∏–Ω—É—Å—ã**:
- –ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–µ—Ä–∞—Ä—Ö–∏–µ–π –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

### 2. –ü–∞—Ç—Ç–µ—Ä–Ω Observer —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º–∏
**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –ø—É—Ç—è–º–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
```typescript
@BindState('tool.current')
class ToolButton extends OhaeBaseView {
  // ...
}
```
**–ü–ª—é—Å—ã**:
- –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–≤—è–∑–µ–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫

**–ú–∏–Ω—É—Å—ã**:
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

### 3. –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Provider
**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: –°–æ–∑–¥–∞—Ç—å StateProvider –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```typescript
new StateProvider({
  state: new StateManager('app'),
  children: [/* –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */]
});
```
**–ü–ª—é—Å—ã**:
- –ò–∑–æ–ª—è—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –õ–µ–≥–∫–∏–π –¥–æ—Å—Ç—É–ø –∏–∑ –ª—é–±—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–ú–∏–Ω—É—Å—ã**:
- –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ —É—Ä–æ–≤–Ω–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏

### 4. –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç—ã
**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: –°–æ–∑–¥–∞—Ç—å —Ä–µ–∞–∫—Ç–∏–≤–Ω—É—é –æ–±–µ—Ä—Ç–∫—É –Ω–∞–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
```typescript
const reactiveState = createReactiveProxy(stateManager);
reactiveState.player.health = 100; // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```
**–ü–ª—é—Å—ã**:
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö

**–ú–∏–Ω—É—Å—ã**:
- –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### 5. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
–î–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Ç–∏–ø–∞ Adobe Animate –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥–æ–π–¥–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
[State Manager] ‚Üî [State Connector] ‚Üî [UI Components]
                ‚Üó           ‚Üñ
        (–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã)    (–∫–æ–Ω—Ç–µ–∫—Å—Ç)
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
1. **StateProvider** –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã** –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–∫–Ω–æ–ø–∫–∏, –∏–Ω–ø—É—Ç—ã)
3. **–†—É—á–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (—Ö–æ–ª—Å—Ç, –≤—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞)
4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞**:
- üé® **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –¢–æ—á–µ—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- üîÑ **–û—Ç–º–µ–Ω–∞/–ü–æ–≤—Ç–æ—Ä**: –õ–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
- üß© **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π
- üîç **–û—Ç–ª–∞–¥–∫–∞**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- üìä **–°–ª–æ–∂–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –õ–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —á–∞—Å—Ç—è–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

**–ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
```typescript
class CanvasEditor extends OhaeBaseView {
  private _unsubscribe: () => void;

  async connectedCallback() {
    const state = await StateProvider.getState(this);
    this._unsubscribe = state.watch('canvas.layers', this.updateLayers);
  }

  disconnectedCallback() {
    this._unsubscribe();
  }

  @BindState('canvas.activeTool')
  updateActiveTool(tool: string) {
    // –û–±–Ω–æ–≤–∏—Ç—å UI –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
  }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
1. Batch-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
3. –î–≤–æ–π–Ω–∞—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
4. –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
5. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤

–î–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∞—Å—Å–µ—Ç–æ–≤ —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –æ–±–µ—Å–ø–µ—á–∏—Ç:
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –õ–µ–≥–∫—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –°—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- –ü—Ä–æ—Å—Ç—É—é –æ—Ç–ª–∞–¥–∫—É —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã


<hr>

# –æ—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π —Ä–µ–∞–ª–∏–∑—É–µ–º - 5. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

–¥–∞–≤–∞–π –Ω–∞–ø–∏—à–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –∏ –¥–æ–ø –º–æ–¥—É–ª–∏ –¥–ª—è:
- State Manager
- State Connector
- –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ UI Components 
- –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- –∫–æ–Ω—Ç–µ–∫—Å—Ç

–∞ —Ç–∞–∫ –∂–µ –Ω–∞–ø–∏—à–µ–º –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
- –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–ø–∏—Å–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫ –¥–∞–Ω–Ω—ã–º –≤ —Å—Ç–µ–π—Ç–µ
- —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç–µ–π—Ç–µ
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ —Å—Ç–µ–π—Ç–µ, –∏ –≤–æ—Å—Ç–∞–Ω–∞–≤–ª–µ–Ω–∏–µ –∏—Ö –ø–æ –≤–Ω–µ—à–Ω–µ–π –∫–æ–º–∞–Ω–¥–µ/—Å–∏–≥–Ω–∞–ª—É


–†–µ–∞–ª–∏–∑—É–µ–º –ø–æ—ç—Ç–∞–ø–Ω–æ:

### 1. State Connector Module (core/state/StateConnector.ts)
```typescript
import { StateManager } from "./StateManager";
import { Await } from "./Await";

type Unsubscribe = () => void;
type StateUpdateHandler<T = any> = (value: T) => void;

export class StateConnector extends Await {
    private static subscriptions = new WeakMap<HTMLElement, Unsubscribe[]>();
    private static statePromises = new WeakMap<HTMLElement, Promise<StateManager>>();

    static connect(element: HTMLElement, statePromise: Promise<StateManager>) {
        this.statePromises.set(element, statePromise);
    }

    static async bind<T>(
        element: HTMLElement,
        path: string,
        handler: StateUpdateHandler<T>
    ): Promise<Unsubscribe> {
        const state = await this.statePromises.get(element);
        const callback = async (event: any) => {
            const value = await state.getValue(path);
            handler(value);
        };
        
        state.onStateUpdate(path, callback);
        const unsubscribe = () => state.offStateUpdate(path, callback);
        
        if (!this.subscriptions.has(element)) {
            this.subscriptions.set(element, []);
        }
        this.subscriptions.get(element)!.push(unsubscribe);
        
        // Initial update
        const initialValue = await state.getValue(path);
        handler(initialValue);
        
        return unsubscribe;
    }

    static disconnect(element: HTMLElement) {
        const subs = this.subscriptions.get(element) || [];
        subs.forEach(unsub => unsub());
        this.subscriptions.delete(element);
        this.statePromises.delete(element);
    }
}
```

### 2. State Provider Component (core/components/StateProvider.ts)
```typescript
import { OhaeLayoutView } from "./layout-view/OhaeLayoutView";
import { StateManager } from "../state/StateManager";
import { StateConnector } from "../state/StateConnector";

export class OhaeStateProvider extends OhaeLayoutView {
    private _stateManager: StateManager;

    constructor(stateManager: StateManager) {
        super();
        this._stateManager = stateManager;
    }

    protected override async createCallback() {
        await super.createCallback();
        this.propagateStateToChildren(this);
    }

    private propagateStateToChildren(element: Element) {
        element.querySelectorAll('*').forEach(child => {
            if (child instanceof HTMLElement) {
                StateConnector.connect(child, Promise.resolve(this._stateManager));
            }
        });
    }
}
```

### 3. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (core/decorators.ts)
```typescript
import { StateConnector } from "./state/StateConnector";

export function BindState(path: string) {
    return (target: any, propertyKey: string) => {
        const connectedCallback = target.connectedCallback;
        const disconnectedCallback = target.disconnectedCallback;

        target.connectedCallback = async function() {
            await connectedCallback?.call(this);
            const element = this as HTMLElement;
            
            StateConnector.bind(element, path, (value) => {
                this[propertyKey] = value;
            });
        };

        target.disconnectedCallback = function() {
            disconnectedCallback?.call(this);
            StateConnector.disconnect(this);
        };
    };
}

export function Action(statePath: string) {
    return (target: any, propertyKey: string, descriptor: PropertyDescriptor) => {
        const originalMethod = descriptor.value;
        
        descriptor.value = async function(...args: any[]) {
            const result = await originalMethod.apply(this, args);
            const state = await StateConnector['statePromises'].get(this);
            state.setValue(statePath, result);
            return result;
        };
        
        return descriptor;
    };
}
```

### 4. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è UI Components (–ø—Ä–∏–º–µ—Ä –¥–ª—è OhaeInputView)
```typescript
import { BindState, Action } from "../decorators";
import { OhaeBaseInputView } from "./OhaeBaseInputView";

export class OhaeInputView extends OhaeBaseInputView {
    @BindState('ui.inputs.textValue')
    declare value: string;

    @Action('ui.actions.lastInput')
    protected override modifyInputEvent(event: InputEvent) {
        const value = super.modifyInputEvent(event);
        return value;
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    async attributeChangedCallback(name: string, oldVal: string, newVal: string) {
        super.attributeChangedCallback(name, oldVal, newVal);
        if (name === 'value') {
            const state = await StateConnector['statePromises'].get(this);
            state.setValue('ui.inputs.textValue', newVal);
        }
    }
}
```

### 5. State Persistence Service (core/state/StatePersist.ts)
```typescript
export class StatePersist {
    static async save(element: HTMLElement, path: string) {
        const state = await StateConnector['statePromises'].get(element);
        const attributes = Array.from(element.attributes)
            .reduce((acc, { name, value }) => {
                acc[name] = value;
                return acc;
            }, {} as Record<string, string>);
        
        state.setValue(`${path}.attributes`, attributes);
    }

    static async restore(element: HTMLElement, path: string) {
        const state = await StateConnector['statePromises'].get(element);
        const attributes = await state.getValue(`${path}.attributes`);
        
        Object.entries(attributes || {}).forEach(([name, value]) => {
            element.setAttribute(name, value);
        });
    }
}
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 1. –ü–æ–¥–ø–∏—Å–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```typescript
import { OhaeButtonView } from "./OhaeButtonView";
import { BindState } from "./decorators";

export class ToolbarButton extends OhaeButtonView {
    @BindState('ui.toolbar.buttons.save')
    declare disabled: boolean;

    @BindState('ui.toolbar.buttons.save.icon')
    declare icon: string;
}
```

#### 2. –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
```typescript
export class CanvasView extends OhaeLayoutView {
    private async setup() {
        const state = await StateConnector['statePromises'].get(this);
        
        StateConnector.bind(this, 'canvas.layers', (layers) => {
            this.renderLayers(layers);
        });
        
        StateConnector.bind(this, 'canvas.activeTool', (tool) => {
            this.setActiveTool(tool);
        });
    }
    
    connectedCallback() {
        this.setup();
    }
}
```

#### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```typescript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
document.querySelector('ohae-editor').addEventListener('save', async (e) => {
    const editor = e.target as HTMLElement;
    await StatePersist.save(editor, 'editor.state');
});

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('load', async () => {
    const editor = document.querySelector('ohae-editor')!;
    await StatePersist.restore(editor, 'editor.state');
});
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞

1. **Batch Updates**:
```typescript
class CanvasOptimizedView extends CanvasView {
    private updateQueue = new Set<string>();
    
    constructor() {
        super();
        this.debouncedUpdate = debounce(this.processUpdates, 100);
    }

    private async processUpdates() {
        const paths = Array.from(this.updateQueue);
        this.updateQueue.clear();
        
        const state = await StateConnector['statePromises'].get(this);
        const updates = await Promise.all(
            paths.map(path => state.getValue(path))
        );
        
        this.batchRender(updates);
    }

    @BindState('canvas.**') // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö –ø—É—Ç–µ–π
    handleCanvasUpdate(path: string, value: any) {
        this.updateQueue.add(path);
        this.debouncedUpdate();
    }
}
```

2. **Priority Updates**:
```typescript
StateConnector.setPriorityRules({
    'canvas.viewport.**': 'high',
    'ui.sidebar.**': 'low',
    'default': 'normal'
});
```

–≠—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ UI
- –ü–æ–¥–¥–µ—Ä–∂–∫—É —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–æ—Å—Ç—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
1. –í–∏–∑—É–∞–ª—å–Ω—ã–π –¥–µ–±–∞–≥–≥–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. –°–∏—Å—Ç–µ–º—É –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. –ü–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤
















<hr>

# –û–ø–∏—à–∏, –¥–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ç–æ–±–æ–π –±–ª–æ–∫–æ–≤ —Å –∫–æ–¥–æ–º–†–∞–∑–±–µ—Ä—ë–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ 

–∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:

### 1. StateConnector (–Ø–¥—Ä–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è)
```typescript
export class StateConnector extends Await {
    // ... implementation ...
}
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: 
- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø–æ–¥–ø–∏—Å–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- `connect()` - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ
- `bind()` - –°–æ–∑–¥–∞—ë—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–≤—è–∑—å —Å–≤–æ–π—Å—Ç–≤–æ ‚Üî –ø—É—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- `disconnect()` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

### 2. OhaeStateProvider (–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞)
```typescript
export class OhaeStateProvider extends OhaeLayoutView {
    // ... implementation ...
}
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:
- –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä StateManager –ø–æ –¥–µ—Ä–µ–≤—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- –°–ª—É–∂–∏—Ç –∫–æ—Ä–Ω–µ–≤—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–∞—Ç—Ç–µ—Ä–Ω Provider –∏–∑ React Context API
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –ø—Ä–æ–ø—Å–æ–≤
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç–æ–º–∫–æ–≤

### 3. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä)
```typescript
export function BindState(path: string) { /*...*/ }
export function Action(statePath: string) { /*...*/ }
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:
- –£–ø—Ä–æ—â–∞—é—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É—é—Ç —Ç–∏–ø–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
  - `BindState` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–≤–æ–π—Å—Ç–≤–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
  - `Action` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–µ—Ç–æ–¥–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏

### 4. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OhaeInputView (–ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
```typescript
export class OhaeInputView extends OhaeBaseInputView {
    @BindState('ui.inputs.textValue')
    // ... implementation ...
}
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—è –≤–≤–æ–¥–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –ü—Ä–∏–º–µ—Ä –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è (UI ‚Üî State)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### 5. StatePersist (–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è)
```typescript
export class StatePersist {
    // ... implementation ...
}
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**:
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ UI –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
  - –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  - –û—Ç–º–µ–Ω–∞/–ø–æ–≤—Ç–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π
  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ú–∏–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
- –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)

#### 1. –ü–æ–¥–ø–∏—Å–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
```typescript
class ToolbarButton extends OhaeButtonView {
    @BindState('ui.toolbar.buttons.save')
    declare disabled: boolean;
}
```
**–ú–µ—Ö–∞–Ω–∏–∫–∞**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—É—Ç–∏ `ui.toolbar.buttons.save`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ `disabled` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø–∏—Å–∫–∞ –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

#### 2. –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Canvas
```typescript
StateConnector.bind(this, 'canvas.layers', (layers) => {
    this.renderLayers(layers);
});
```
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –†—É—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å–ª–æ—ë–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

#### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```typescript
StatePersist.save(editor, 'editor.state');
```
**–ü—Ä–æ—Ü–µ—Å—Å**:
1. –°–±–æ—Ä –≤—Å–µ—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
2. –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

#### Batch Updates
```typescript
this.debouncedUpdate = debounce(this.processUpdates, 100);
```
**–†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã**:
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ä–µ–Ω–¥–µ—Ä-–¥–≤–∏–∂–æ–∫
- "–î—Ä–æ–∂–∞–Ω–∏–µ" –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

**–ú–µ—Ö–∞–Ω–∏–∫–∞**:
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏
- –ì—Ä—É–ø–ø–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### Priority Updates
```typescript
StateConnector.setPriorityRules({
    'canvas.viewport.**': 'high',
    'ui.sidebar.**': 'low'
});
```
**–ö—Ä–∏—Ç–µ—Ä–∏–∏**:
- `high`: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö–æ–ª—Å—Ç)
- `normal`: –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `low`: –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∫–∞–¥—Ä–æ–≤ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∏
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU

### –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]
    ‚îÇ
    ‚ñº
[UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã] ‚óÑ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ               ‚îÇ
    ‚ñº               ‚îÇ
[–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã] ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ [StateConnector] ‚óÑ‚îÄ‚îÄ‚îÄ‚ñ∫ [StateManager]
    ‚îÇ               ‚îÇ
    ‚ñº               ‚ñº
[–†–µ–Ω–¥–µ—Ä]       [–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ]
```

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º
2. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ
3. StateConnector –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
4. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
5. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞**:
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å undo/redo
- –õ—ë–≥–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª—ë–Ω–Ω–æ–π –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏ –≥–∏–±–∫–æ—Å—Ç—å—é, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–µ—Å—É—Ä—Å–æ—ë–º–∫–∏—Ö –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.